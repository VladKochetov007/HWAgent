# LaTeX Fixes Guide for HWAgent

## –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### 1. –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –î–≤–æ–π–Ω—ã–µ —Å–ª–µ—à–∏ (`\\`)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ —Ç–∏–ø–∞ "There's no line here to end"
- –û—à–∏–±–∫–∏ —Ç–∏–ø–∞ "Missing \begin{document}"
- LaTeX –∫–æ–º–∞–Ω–¥—ã —Å –¥–≤–æ–π–Ω—ã–º–∏ —Å–ª–µ—à–∞–º–∏: `\\documentclass`, `\\usepackage`, `\\begin`, etc.

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö** - –∫–æ–≥–¥–∞ LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç LaTeX –∫–æ–¥, –æ–Ω –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ª–∏—à–Ω–∏–µ —Å–ª–µ—à–∏
2. **–ü—Ä–æ–±–ª–µ–º—ã –≤ —à–∞–±–ª–æ–Ω–∞—Ö** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `{{` –≤–º–µ—Å—Ç–æ `{` –≤ raw strings
3. **–û—à–∏–±–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Ç—Ä–æ–∫** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏—è:**

#### –í –ø—Ä–æ–º–ø—Ç–∞—Ö (`hwagent/config/prompts.yaml`):
```yaml
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- ‚úÖ NEVER use double backslashes `\\` except for line breaks
- ‚ùå AVOID: `\\documentclass`, `\\usepackage`, `\\begin`, `\\end` (use single backslash)
- üîß USE latex_fix tool if ANY compilation errors occur
```

#### –í LaTeX Fix Tool (`hwagent/tools/latex_fix_tool.py`):
- –£–ª—É—á—à–µ–Ω –º–µ—Ç–æ–¥ `_fix_double_backslashes()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `_is_severely_broken()` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
- –£–ª—É—á—à–µ–Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ `_final_cleanup()`

### 2. –û—à–∏–±–∫–∏ "Missing $ inserted"

**–°–∏–º–ø—Ç–æ–º—ã:**
- LaTeX –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏–º–≤–æ–ª—ã `_` –∏ `^` –≤–Ω–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞

**–†–µ—à–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `x_1` ‚Üí `x\_1` –∏–ª–∏ `\(x_1\)`
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º: `x^2` ‚Üí `\(x^2\)`

### 3. –°–º–µ—à–∞–Ω–Ω—ã–π Markdown –∏ LaTeX —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å `##` –≤–º–µ—Å—Ç–æ `\section{}`
- –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç —Å `**` –≤–º–µ—Å—Ç–æ `\textbf{}`
- –°–ø–∏—Å–∫–∏ —Å `-` –≤–º–µ—Å—Ç–æ `\item`

**–†–µ—à–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥–µ `_convert_markdown_to_latex()`

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `\documentclass`
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `\begin{document}` –∏–ª–∏ `\end{document}`

**–†–µ—à–µ–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –º–µ—Ç–æ–¥–µ `_fix_structure()`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. LaTeX Fix Tool
```python
from hwagent.tools.latex_fix_tool import LaTeXFixTool

tool = LaTeXFixTool()
result = tool.execute(filepath="problem.tex", task_type="math")
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ–π–Ω—ã—Ö —Å–ª–µ—à–µ–π
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Markdown –≤ LaTeX
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ü–æ–ª–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —à–∞–±–ª–æ–Ω–æ–≤

### 2. Smart LaTeX Generator
```python
from hwagent.tools.smart_latex_generator_tool import SmartLaTeXGenerator

tool = SmartLaTeXGenerator()
result = tool.execute(
    filepath="document.tex",
    title="–ó–∞–≥–æ–ª–æ–≤–æ–∫",
    content_sections={
        "problem_statement": "–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...",
        "solution": "–†–µ—à–µ–Ω–∏–µ..."
    },
    task_type="math",
    language="russian"
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å

### 3. LaTeX Compile Tool
```python
from hwagent.tools.latex_compile_tool import LaTeXCompileTool

tool = LaTeXCompileTool()
result = tool.execute(filepath="document.tex")
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤ PDF
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –¥–≤–∏–∂–∫–æ–≤ LaTeX

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Smart LaTeX Generator
generator = SmartLaTeXGenerator()
result = generator.execute(...)
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
```python
# 1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
fix_tool = LaTeXFixTool()
fix_result = fix_tool.execute(filepath="document.tex")

# 2. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ
compile_tool = LaTeXCompileTool()
compile_result = compile_tool.execute(filepath="document.tex")

# 3. –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
if not compile_result.is_success():
    fix_result = fix_tool.execute(filepath="document.tex", task_type="math")
    compile_result = compile_tool.execute(filepath="document.tex")
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è LLM:
1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤–æ–π–Ω—ã–µ —Å–ª–µ—à–∏** –∫—Ä–æ–º–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
2. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ latex_fix** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
3. **–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ smart_latex_generator** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å** –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:
```yaml
- ‚úÖ Use `\documentclass{article}` NOT `\\documentclass{article}`
- ‚úÖ Use `\section{Title}` NOT `## Title`
- ‚úÖ Use `\textbf{bold}` NOT `**bold**`
- ‚úÖ Use `\[ math \]` NOT `$$ math $$`
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```bash
python test_latex_fixes.py
```

–≠—Ç–æ—Ç —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª—ã —Å —Ç–∏–ø–∏—á–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∫–æ–º–ø–∏–ª—è—Ü–∏—é.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å LaTeX –≤ HWAgent —Å–≤—è–∑–∞–Ω—ã —Å:
1. **–î–≤–æ–π–Ω—ã–º–∏ —Å–ª–µ—à–∞–º–∏** - —Ä–µ—à–∞–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–Ω—ã–º LaTeX Fix Tool
2. **–°–º–µ—à–∞–Ω–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º** - —Ä–µ—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏** - —Ä–µ—à–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Smart LaTeX Generator –¥–ª—è –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ LaTeX Fix Tool –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö. 